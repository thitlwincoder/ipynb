# Multi-App (Backend)

This project have three module: server panel, project panel and app panel.

-  Server Panel
   - Acts as the central admin dashboard.
   - Can manage all projects across the platform.
   - Responsibilities include:
     - Creating and managing projects.
     - Automatically generating a unique API key for each project.
     - Managing server-users with server-roles and server-permissions.

- Project Panel
  - Designed for per project-level management.
  - Each project uses the API key generated by the server panel.
  - Responsibilities include:
    - Managing a single project context.
    - Controlling multiple apps under the same project.

- App Panel
   - Designed for per app-level management.
   - Each app uses the API key and App Id by the project.
   - Responsibilities include:
     - Managing a single app context.
     - Controlling products, product-categories, etc.

### Part 1 - Setup
- [x] read 'FOLDER_STRUCTURE.md' and create folder structure
- [x] package.json: add npm run db:seed, etc

### Part 2 - .env
- [x]  App Name
  - APP_NAME=DGHub
- [x] Node Environment
  - NODE_ENV=development
  - In development mode, allow all CORS origins (*).
- [x] Database Configuration
  - DB_TYPE=postgresql
  - DB_HOST=localhost
  - DB_PORT=5432
  - DB_USERNAME=postgres
  - DB_PASSWORD=your_password
  - DB_NAME=dghub_dev
- [x] Mail config
- [x] Radius Configuration
  - RADIUS_PASSWORD=radis2567356363#@#
- [x] JWT Configuration
  - JWT_SECRET= (auto-generated using: npm run generate:jwt)
  - Add script to generate and save a random secure JWT secret.
- [x] Panel & API URLs
  - BACKEND_URL_DEV=http://api.localhost:7000
  - BACKEND_URL_PRO=https://api.dghub.dev
  - SERVER_PANEL_DEV=http://server-panel.localhost:7001
  - SERVER_PANEL_PRO=https://server-panel.dghub.dev
  - PROJECT_PANEL_DEV=http://project-panel.localhost:7002
  - PROJECT_PANEL_PRO=https://project-panel.dghub.dev
  - APP_PANEL_DEV=http://app-panel.localhost:7003
  - APP_PANEL_PRO=https://app-panel.dghub.dev
- [x] Storage Configuration
  - STORAGE_TYPE=local (or aws3)
- [x] AWS S3 Configuration
  - AWS_ACCESS_KEY_ID=your_key
  - AWS_SECRET_ACCESS_KEY=your_secret
  - AWS_REGION=us-west-1
  - AWS_BUCKET_NAME=dghub-storage

### Part 3 – Database Models 

#### Server Panel Models
- [ ] server-user
  - Fields: id, photo, name, email, password, phone, age, bannedAt, deletedAt, createdAt, updatedAt, ip, roleId
  - Notes:
    - password and ip should be hidden from public API.
    - ref: roleId is server-role.
- [ ] server-user-address
  - Relation to server-user
  - Fields: id, userId, address, city, state, zip, country
- [ ] server-role
  - Fields: id, name, permissions (JSONB or array)
  - Seed roles: superadmin, admin, moderator, viewer
-  generalSettings (appname: get .env, logo) , mailSettings (get .env), themeSettings () , currencySettings (), storageSettings, rateLimitSettings (),
- [ ] project
  - Fields: id, name, photo, apikey, ownerId, domain, deletedAt, createdAt, updatedAt
  - apikey: auto-generated string (e.g., UUID or nanoid)
  - ownerId: foreign key → server_user.id
- [ ] app-type
  - Fields: id, name, type

#### project panel
- [ ] project-user: id (auto increment),photo, name , email, password (hide), phone , age, bannedAt, deletedAt, createdAt, updatedAt, ip (hide)
- [ ] project-role: id (auto increment), name, permissions
- [ ] project-setting: generalSettings () , themeSettings () , currencySettings ()
- [ ] apps: id (auto increment), photo, name, domain, appType (get:server panel), 
- [ ] payment: 


### app panel
- [ ] app-user: id (auto increment),photo, name , email, password (hide), phone , age, bannedAt, deletedAt, createdAt, updatedAt, ip (hide)
- [ ] app-role: id (auto increment), name, permissions
- [ ] app-setting: generalSettings () ,  themeSettings () , currencySettings ()
- [ ] product: id (auto increment), 
- [ ] product-category: id (auto increment),
- [ ] product-variations: id (auto increment),
- [ ] product-single-addon: id (auto increment),
- [ ] product-multiple-addon: id (auto increment),
- [ ] product-combo: id (auto increment),
- [ ] product-order: id (auto increment)
- [ ] booking: id (auto increment)
- [ ] table: id (auto increment)
- [ ] department: id (auto increment)
- [ ] leave-request: id (auto increment)
- [ ] leave-request-type: id (auto increment)
- [ ] notice: id (auto increment)
- [ ] push-notification: id (auto increment)
- [ ] location-slot:
- [ ] intent-group: 
- [ ] languaage: 
- [ ] contact:
- [ ] payment:
- [ ] address: 


### Part 4 - Authentication
- [ ] Server panel middleware: server-user, server-role
      - login only, do not need register, do not need forgot password
      - linked oauth (for logged user): github, google - add config with .env and server-setting
- [ ] Project panel middleware: project-user, project-role, project api key 
     - login , forgot password, email verification
     - linked oauth (for logged user): facebook, google - add config with project-setting (private)
- [ ] App panel middleware: app-user, app-role , app id, project api key
     - login, register, forgot password, email verificattion
     - oauth: otp (routee), google, x, whatsapp, telegram, facebook - add config with app-setting (private)

### Part 5 - CRUD Setup
 - [ ] controller
      - pagination count: 20
 - [ ] services
 - [ ] validation
 - [ ] error handling
 - [ ] logging
 - [ ] swagger

### Part 6 - Socket Setup
 - [ ] realtime: insert, update, delete

### Part 7 - Seeder - for default data
- [ ] Users
  - Seed the following three user types:
    - Server User
    - Project User
    - App User
  - All users share the same default credentials:
    - Email: admin@example.com
    - Password: password123
 - [ ] Project
   - Create a default project with the following details:
     - Name: Default Project
     - API Key: default-api-key
     - ID: 1 (fixed ID for easy reference)
   - This project acts as a base for the default app and user assignments.
 - [ ] App Types
  - Seed the following application types:
    - Shop
    - KTV Booking
    - Factory
    - Taxi
    - Hotel Booking
    - Movie
  - These types are selectable when creating new apps or projects.
 - [ ] App
   - Create a default app with the following attributes:
     - Name: Default App
     - App ID: 1 (fixed)
   - The default app will be linked to the default project.
 - [ ] Products & Categories
   - Generate the following sample data per app:
     - 25 products
     - 25 categories
   - All generated data should be linked to the default app.
   - Use realistic mock values (e.g., name, price, description) for meaningful UI and API testing.

### Part 8 - Email Setup
 - [ ] Server Panel
   - Connect to mail configuration via:
     - .env variables
     - server_setting.mailSettings object
  - Email use case:
    - Account verification email (mail verify only)
  - Should not handle any other email types beyond initial verification.
 - [ ] Project Panel
     - Connect to mail configuration via:
       - project_setting.mailSettings (project-specific mail settings)
     - Email use cases:
       - Account verification (mail verify)
       - Forgot password reset link
 - [ ] App Panel
     - Connect to mail configuration via:
       - app_setting.mailSettings (per-app mail settings)
     - Email use cases:
       - Account verification (mail verify)
       - Forgot password reset
       - Order invoice (after successful order)
       - Payment refund notification
       - Account banned notice
       - Account unbanned notice

### Part 9 - Backup

### Part 10 - Cron

### Part 9 - Testing
 - [ ] api
 - [ ] socket
 - [ ] unit
-  [ ] etc

### Note
- [ ] AWS S3 and Storage Limit
  - If using STORAGE_TYPE=aws3, ensure that AWS credentials and bucket settings are correctly configured in both .env and storageSettings.
  - Implement per-project or per-app storage limits (e.g., max upload size, total storage usage).
  - Consider setting soft and hard limits:
    - Soft limit: warning shown to user/admin
    - Hard limit: block uploads
- [ ] Settings Management
  - All configurable settings (such as mail, theme, rate limit, and storage) should be structured and managed in:
    - server_setting for server panel
    - project_setting for project panel
    - app_setting for app panel
  - Ensure settings are accessible and override-able per scope (global > project > app).
- [ ] .env: Image Upload Size Limit
  - Add the following environment variable to control upload size:
    - MAX_UPLOAD_IMAGE_SIZE_MB=5
  - Enforce this value in file validation logic (both backend and optionally in frontend).
- [ ] Account Creation Limit: One Device, Three Accounts
  - Limit account registration to a maximum of 3 accounts per unique combination of:
    - IP address
    - Operating System
    - Build ID (optional device fingerprint)
  - Useful to prevent abuse during account creation.
  - Should log device metadata at account registration and validate against the limit before creating a new account.
